# v0.3.0：物件頭重構

<br>

---

<br>

**目標**：實現標準的物件頭（Object Header），為多執行緒和 GC 打基礎

**設計要點**：

```
物件頭結構（Mark Word）- 64 位元系統：

┌────────────────────────────────────────────────────────────┐
│                      Mark Word (64 bits)                   │
├─────────┬───────────┬────────┬─────────┬──────────────────┤
│ unused  │ hashCode  │  age   │ biased  │   lock state     │
│ (25 bit)│ (31 bit)  │(4 bit) │ (1 bit) │    (3 bit)       │
└─────────┴───────────┴────────┴─────────┴──────────────────┘
           │            │         │            │
           │            │         │            └─ 鎖狀態（多執行緒用）
           │            │         └─ 偏向鎖標記（多執行緒用）
           │            └─ GC 年齡（GC 用）
           └─ 物件 hashCode（Object.hashCode 用）

Lock State:
  001 = 無鎖
  101 = 偏向鎖
  00  = 輕量級鎖
  10  = 重量級鎖
  11  = GC 標記
```

<br>

**需要修改的模組**：

```go
// runtime/heap/object.go

type Object struct {
    markWord uint64        // 新增：物件頭
    class    *Class        // 類型指標
    fields   Slots         // 實例欄位
    extra    interface{}   // 額外資料（陣列元素等）
}

// Mark Word 操作
func (o *Object) HashCode() int32
func (o *Object) SetHashCode(hash int32)
func (o *Object) GCAge() uint8
func (o *Object) IncrementAge()
func (o *Object) LockState() uint8
func (o *Object) SetLockState(state uint8)
```

<br>
