# v0.4.4：volatile 與記憶體模型

<br>

---

<br>

**目標**：實現 `volatile` 語義與基本的記憶體可見性

**設計要點**：

```
volatile 的兩個語義：

1. 可見性：一個執行緒修改 volatile 變數後，其他執行緒立即可見

2. 禁止重排序：volatile 讀寫前後的操作不能重排序

Happens-Before 規則：
┌─────────────────────────────────────────────────────────┐
│ 對 volatile 變數的寫入 happens-before 後續對該變數的讀取 │
└─────────────────────────────────────────────────────────┘
```

<br>

**需要處理的情況**：

```go
// runtime/method_area/field.go
func (f *Field) IsVolatile() bool {
    return f.accessFlags & ACC_VOLATILE != 0
}

// 對 volatile 欄位的讀寫需要：
// 1. 使用 atomic 操作
// 2. 插入適當的記憶體屏障
```

<br>