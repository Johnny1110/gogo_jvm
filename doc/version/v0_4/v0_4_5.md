# v0.4.5：Safe Point 機制

<br>

---

<br>

**目標**：實現安全點機制，為 GC 的 Stop-The-World 做準備

**設計要點**：

```
Safe Point（安全點）：
執行緒可以安全暫停的位置，此時：
- 所有 GC Roots 都可以被正確識別
- 物件引用關係穩定

常見的 Safe Point 位置：
├── 方法呼叫/返回
├── 迴圈回邊（back edge）
├── 異常拋出
└── JNI 呼叫前後
```

<br>

**Stop-The-World 流程**：

```
  GC Thread                    Application Threads
      │                              │ │ │
      │ 發起 STW 請求                 │ │ │
      ├──────────────────────────►   │ │ │
      │                              │ │ │
      │                          到達 Safe Point
      │                              ● ● ●
      │ ◄────────────────────────────┘ │ │
      │ ◄──────────────────────────────┘ │
      │ ◄────────────────────────────────┘
      │
      │ 所有執行緒已暫停
      ▼
   執行 GC
      │
      │ 恢復執行
      ├──────────────────────────► │ │ │
      │                            │ │ │
```

<br>
