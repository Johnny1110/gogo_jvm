# v0.2.9：字串支援

<br>

---

<br>

**目標**：實現完整的 `java.lang.String` 支援

**設計要點**：

```
String 在 JVM 中的結構：
┌─────────────────────────────────────┐
│ String Object                       │
├─────────────────────────────────────┤
│ class → java/lang/String            │
│ fields:                             │
│   value → char[] (存放字元)          │
│   hash  → int (hash code 快取)      │
└─────────────────────────────────────┘
```

<br>

**需要實現的功能**：

| 功能 | 說明 |
|------|------|
| String 物件結構 | 模擬 `java.lang.String` 類 |
| 字串駐留 (String Interning) | 相同字串共用同一物件 |
| `ldc` 載入字串 | 從常量池載入字串常量 |
| `println(String)` | 完整的字串輸出支援 |

<br>

**字串駐留機制**：

```go
// runtime/heap/string_pool.go

var internedStrings = map[string]*Object{}

// InternString 字串駐留
// 相同內容的字串返回同一個 Object
func InternString(goStr string) *Object {
    if obj, ok := internedStrings[goStr]; ok {
        return obj
    }
    
    // 創建新的 String 物件
    chars := stringToUtf16(goStr)
    obj := NewStringObject(chars)
    internedStrings[goStr] = obj
    return obj
}
```

<br>

**測試目標**：

```java
public class TestString {
    public static void main(String[] args) {
        String s1 = "Hello";
        String s2 = "World";
        System.out.println(s1);       // 輸出: Hello
        System.out.println(s2);       // 輸出: World
        System.out.println("Done");   // 輸出: Done
    }
}
```

<br>